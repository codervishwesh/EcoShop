{% extends 'base.html' %}
{% load static %}

{% block title %}Management Dashboard - EcoShop{% endblock %}

{% block content %}
<div class="bg-gradient-to-r from-green-600 to-emerald-700 py-8">
    <div class="container mx-auto px-4">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold text-white">
                    {% if is_admin %}ğŸ‘‘ Admin{% else %}ğŸ‘” Supervisor{% endif %} Dashboard
                </h1>
                <p class="text-green-100 mt-1">Welcome back, {{ request.user.username }}!</p>
            </div>
            <div class="flex gap-4">
                {% if is_admin %}
                <a href="{% url 'accounts:reports' %}" class="bg-white text-green-600 px-4 py-2 rounded-lg hover:bg-green-50 transition">
                    ğŸ“Š View Reports
                </a>
                {% endif %}
                <a href="{% url 'admin:index' %}" class="bg-green-800 text-white px-4 py-2 rounded-lg hover:bg-green-900 transition">
                    ğŸ”§ Django Admin
                </a>
            </div>
        </div>
    </div>
</div>

<div class="container mx-auto px-4 py-8">
    <!-- Quick Stats -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="bg-white rounded-xl shadow-md p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-500 text-sm">Total Products</p>
                    <p class="text-3xl font-bold text-gray-800">{{ stats.total_products }}</p>
                </div>
                <span class="text-4xl">ğŸ“¦</span>
            </div>
            <a href="{% url 'accounts:product_management_list' %}" class="text-green-600 text-sm mt-2 inline-block hover:underline">
                Manage Products â†’
            </a>
        </div>
        
        <div class="bg-white rounded-xl shadow-md p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-500 text-sm">Total Orders</p>
                    <p class="text-3xl font-bold text-gray-800">{{ stats.total_orders }}</p>
                </div>
                <span class="text-4xl">ğŸ›’</span>
            </div>
            <a href="{% url 'accounts:order_management_list' %}" class="text-green-600 text-sm mt-2 inline-block hover:underline">
                View Orders â†’
            </a>
        </div>
        
        <div class="bg-white rounded-xl shadow-md p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-500 text-sm">Total Customers</p>
                    <p class="text-3xl font-bold text-gray-800">{{ stats.total_customers }}</p>
                </div>
                <span class="text-4xl">ğŸ‘¥</span>
            </div>
            {% if is_admin %}
            <a href="{% url 'accounts:user_list' %}" class="text-green-600 text-sm mt-2 inline-block hover:underline">
                Manage Users â†’
            </a>
            {% endif %}
        </div>
        
        <div class="bg-white rounded-xl shadow-md p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-500 text-sm">Total Revenue</p>
                    <p class="text-3xl font-bold text-gray-800">${{ stats.total_revenue|floatformat:2 }}</p>
                </div>
                <span class="text-4xl">ğŸ’°</span>
            </div>
            <p class="text-gray-500 text-sm mt-2">Pending: {{ stats.pending_orders }} orders</p>
        </div>
    </div>
    
    <!-- Secondary Stats (Admin Only) -->
    {% if is_admin %}
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div class="bg-gradient-to-r from-red-500 to-red-600 rounded-xl shadow-md p-6 text-white">
            <p class="text-red-100 text-sm">Admins</p>
            <p class="text-2xl font-bold">{{ stats.total_admins }}</p>
        </div>
        <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl shadow-md p-6 text-white">
            <p class="text-blue-100 text-sm">Supervisors</p>
            <p class="text-2xl font-bold">{{ stats.total_supervisors }}</p>
        </div>
        <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl shadow-md p-6 text-white">
            <p class="text-purple-100 text-sm">Categories</p>
            <p class="text-2xl font-bold">{{ stats.total_categories }}</p>
        </div>
        <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-xl shadow-md p-6 text-white">
            <p class="text-yellow-100 text-sm">Avg EcoScore</p>
            <p class="text-2xl font-bold">{{ stats.avg_eco_score|floatformat:0 }}</p>
        </div>
    </div>
    {% endif %}
    
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Quick Actions -->
        <div class="bg-white rounded-xl shadow-md p-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">âš¡ Quick Actions</h2>
            <div class="grid grid-cols-2 gap-4">
                <a href="{% url 'accounts:product_management_list' %}" 
                   class="flex items-center gap-3 p-4 bg-green-50 rounded-lg hover:bg-green-100 transition">
                    <span class="text-2xl">ğŸ“¦</span>
                    <div>
                        <p class="font-semibold text-gray-800">Products</p>
                        <p class="text-sm text-gray-500">Manage inventory</p>
                    </div>
                </a>
                
                <a href="{% url 'accounts:order_management_list' %}" 
                   class="flex items-center gap-3 p-4 bg-blue-50 rounded-lg hover:bg-blue-100 transition">
                    <span class="text-2xl">ğŸ›’</span>
                    <div>
                        <p class="font-semibold text-gray-800">Orders</p>
                        <p class="text-sm text-gray-500">Process orders</p>
                    </div>
                </a>
                
                <a href="{% url 'accounts:review_management_list' %}" 
                   class="flex items-center gap-3 p-4 bg-yellow-50 rounded-lg hover:bg-yellow-100 transition">
                    <span class="text-2xl">â­</span>
                    <div>
                        <p class="font-semibold text-gray-800">Reviews</p>
                        <p class="text-sm text-gray-500">Moderate reviews</p>
                    </div>
                </a>
                
                {% if is_admin %}
                <a href="{% url 'accounts:user_list' %}" 
                   class="flex items-center gap-3 p-4 bg-purple-50 rounded-lg hover:bg-purple-100 transition">
                    <span class="text-2xl">ğŸ‘¥</span>
                    <div>
                        <p class="font-semibold text-gray-800">Users</p>
                        <p class="text-sm text-gray-500">Manage accounts</p>
                    </div>
                </a>
                {% else %}
                <a href="{% url 'admin:index' %}" 
                   class="flex items-center gap-3 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                    <span class="text-2xl">ğŸ”§</span>
                    <div>
                        <p class="font-semibold text-gray-800">Admin Panel</p>
                        <p class="text-sm text-gray-500">Advanced options</p>
                    </div>
                </a>
                {% endif %}
            </div>
            
            {% if is_admin %}
            <div class="mt-4 pt-4 border-t border-gray-200">
                <a href="{% url 'accounts:create_staff' %}" 
                   class="w-full flex items-center justify-center gap-2 p-3 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg hover:from-green-700 hover:to-emerald-700 transition">
                    <span>â•</span>
                    <span>Create Staff Account</span>
                </a>
            </div>
            {% endif %}
        </div>
        
        <!-- Low Stock Alert -->
        <div class="bg-white rounded-xl shadow-md p-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">âš ï¸ Low Stock Products</h2>
            {% if low_stock_products %}
            <div class="space-y-3">
                {% for product in low_stock_products %}
                <div class="flex items-center justify-between p-3 bg-red-50 rounded-lg">
                    <div class="flex items-center gap-3">
                        {% if product.image %}
                        <img src="{{ product.image.url }}" alt="{{ product.name }}" class="w-10 h-10 rounded object-cover">
                        {% else %}
                        <div class="w-10 h-10 bg-gray-200 rounded flex items-center justify-center">ğŸ“¦</div>
                        {% endif %}
                        <div>
                            <p class="font-medium text-gray-800">{{ product.name|truncatechars:30 }}</p>
                            <p class="text-sm text-red-600">Only {{ product.stock }} left!</p>
                        </div>
                    </div>
                    <a href="{% url 'accounts:product_management_edit' product.pk %}" 
                       class="text-green-600 hover:text-green-700">
                        Edit â†’
                    </a>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-gray-500 text-center py-8">âœ… All products are well stocked!</p>
            {% endif %}
        </div>
    </div>
    
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mt-8">
        <!-- Recent Orders -->
        <div class="bg-white rounded-xl shadow-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800">ğŸ“‹ Recent Orders</h2>
                <a href="{% url 'accounts:order_management_list' %}" class="text-green-600 hover:underline text-sm">
                    View All â†’
                </a>
            </div>
            <div class="space-y-3">
                {% for order in recent_orders %}
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                    <div>
                        <p class="font-medium text-gray-800">{{ order.order_number }}</p>
                        <p class="text-sm text-gray-500">{{ order.user.username }} â€¢ ${{ order.total }}</p>
                    </div>
                    <div class="text-right">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full
                            {% if order.status == 'delivered' %}bg-green-100 text-green-800
                            {% elif order.status == 'shipped' %}bg-purple-100 text-purple-800
                            {% elif order.status == 'processing' %}bg-blue-100 text-blue-800
                            {% elif order.status == 'cancelled' %}bg-red-100 text-red-800
                            {% else %}bg-yellow-100 text-yellow-800{% endif %}">
                            {{ order.get_status_display }}
                        </span>
                        <p class="text-xs text-gray-500 mt-1">{{ order.created_at|date:"M d, Y" }}</p>
                    </div>
                </div>
                {% empty %}
                <p class="text-gray-500 text-center py-4">No orders yet</p>
                {% endfor %}
            </div>
        </div>
        
        <!-- Recent Reviews -->
        <div class="bg-white rounded-xl shadow-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800">â­ Recent Reviews</h2>
                <a href="{% url 'accounts:review_management_list' %}" class="text-green-600 hover:underline text-sm">
                    View All â†’
                </a>
            </div>
            <div class="space-y-3">
                {% for review in recent_reviews %}
                <div class="p-3 bg-gray-50 rounded-lg">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="font-medium text-gray-800">{{ review.product.name|truncatechars:25 }}</p>
                            <p class="text-sm text-gray-500">by {{ review.user.username }}</p>
                        </div>
                        <div class="text-yellow-500">
                            {% for i in "12345" %}
                                {% if forloop.counter <= review.rating %}â­{% else %}â˜†{% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    <p class="text-sm text-gray-600 mt-2">{{ review.comment|truncatechars:100 }}</p>
                </div>
                {% empty %}
                <p class="text-gray-500 text-center py-4">No reviews yet</p>
                {% endfor %}
            </div>
        </div>
    </div>
    
    <!-- Permission Info -->
    <div class="mt-8 bg-gray-50 rounded-xl p-6">
        <h3 class="font-bold text-gray-800 mb-3">ğŸ” Your Permissions</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="text-center p-3">
                <span class="text-2xl">{% if request.user.can_create_product %}âœ…{% else %}âŒ{% endif %}</span>
                <p class="text-sm text-gray-600 mt-1">Create Products</p>
            </div>
            <div class="text-center p-3">
                <span class="text-2xl">{% if request.user.can_delete_product %}âœ…{% else %}âŒ{% endif %}</span>
                <p class="text-sm text-gray-600 mt-1">Delete Products</p>
            </div>
            <div class="text-center p-3">
                <span class="text-2xl">{% if request.user.can_manage_users %}âœ…{% else %}âŒ{% endif %}</span>
                <p class="text-sm text-gray-600 mt-1">Manage Users</p>
            </div>
            <div class="text-center p-3">
                <span class="text-2xl">{% if request.user.can_view_all_reports %}âœ…{% else %}âŒ{% endif %}</span>
                <p class="text-sm text-gray-600 mt-1">Full Reports</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
